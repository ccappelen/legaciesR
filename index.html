<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data management for the LEGACIES data project • legaciesr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Data management for the LEGACIES data project">
<meta name="description" content="Contains functions for aggregating overlapping polygons.">
<meta property="og:description" content="Contains functions for aggregating overlapping polygons.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">legaciesr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ccappelen/legaciesR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="legaciesr">legaciesr<a class="anchor" aria-label="anchor" href="#legaciesr"></a>
</h1></div>
<!-- <!-- badges: start -->
<p>–&gt;</p>
<!-- [![Codecov test coverage](https://codecov.io/gh/ccappelen/legaciesR/graph/badge.svg)](https://app.codecov.io/gh/ccappelen/legaciesR) -->
<!-- [![R-CMD-check](https://github.com/ccappelen/legaciesR/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/ccappelen/legaciesR/actions/workflows/R-CMD-check.yaml) -->
<!-- <!-- badges: end -->
<p>–&gt;</p>
<p>The <code>legaciesr</code> package provides a set of functions used to aggregate and summarize the mapping data collected in the <a href="https://www.legacies-project.com" class="external-link">LEGACIES</a> project. It allows users to, i.a., (1) create contour polygons capturing the territorial extent of historical states at different probability thresholds, (2) create a grid with various summary measures of historical state presence, and (3) add a range of commonly used covariates to the polygon and grid data.</p>
<p>NB: The package is still experimental and no functions should be considered stable.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of legaciesr from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ccappelen/legaciesR"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.legacies-project.com" class="external-link">legaciesr</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="errors-in-current-master_shapefile">Errors in current master_shapefile<a class="anchor" aria-label="anchor" href="#errors-in-current-master_shapefile"></a>
</h2>
<p>Currently, one geometry (COWID = “EGY”) fails to rebuild due to crossing edges. However, a few other COWIDs result in invalid geometries when creating contour polygons. For now, these are omitted:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">COWID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EGY"</span>, <span class="st">"LUN"</span>, <span class="st">"KUN"</span>, <span class="st">"SAF"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="handling-of-invalid-geometries">Handling of invalid geometries<a class="anchor" aria-label="anchor" href="#handling-of-invalid-geometries"></a>
</h2>
<p>The functions in <code>legaciesr</code> will (by default) attempt to fix invalid geometries which would otherwise return an error. The fixes rely on <code><a href="reference/fix_invalid.html">legaciesr::fix_invalid()</a></code> which is a wrapper around the <code><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">sf::st_make_valid()</a></code> function that attempts to reiteratively lower the allowed precision to rebuild valid geometries. However, because invalid geometries can happen for many reasons that may point to other data errors as well, it is recommended to check for valid geometries and run the <code><a href="reference/fix_invalid.html">legaciesr::fix_invalid()</a></code> to identify potential issues. See package documentation for further information on the use of this function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">example_df</span> <span class="co"># Load example data set (based on random data)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fix_invalid.html">fix_invalid</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 (0 %) geometries were successfully rebuilt.</span></span>
<span><span class="co">#&gt; 0 (0 %) geometries failed to rebuild as valid.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-contour-polygons-for-a-single-group">Create contour polygons for a single group<a class="anchor" aria-label="anchor" href="#create-contour-polygons-for-a-single-group"></a>
</h2>
<p>See documentation for additional arguments (e.g., threshold for number of maps, the number of contour polygons, resolution of raster, and handling of invalid geometries).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="reference/contour_polygons.html">contour_polygons</a></span><span class="op">(</span><span class="va">df1</span>, id_vars <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 4 features and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -10.55116 ymin: 6.086814 xmax: -1.417828 ymax: 13.82015</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;      name prob  label nmaps                       geometry</span></span>
<span><span class="co">#&gt; 1 Genovia 0.00    0-1   191 POLYGON ((-4.726162 13.8201...</span></span>
<span><span class="co">#&gt; 2 Genovia 0.25 0.25-1   191 POLYGON ((-5.182412 12.9201...</span></span>
<span><span class="co">#&gt; 3 Genovia 0.50  0.5-1   191 POLYGON ((-5.774078 12.3201...</span></span>
<span><span class="co">#&gt; 4 Genovia 0.75 0.75-1   191 MULTIPOLYGON (((-4.451162 9...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-contour-polygons-across-all-groups">Create contour polygons across all groups<a class="anchor" aria-label="anchor" href="#create-contour-polygons-across-all-groups"></a>
</h2>
<p>See documentation for additional arguments (e.g., specifying the period intervals to group by, thresholds for number of maps within a group, etc.).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_contours.html">get_contours</a></span><span class="op">(</span><span class="va">df</span>, grp_id <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 88 features and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -10.55116 ymin: -23.1782 xmax: 46.4739 ymax: 35.56434</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;           name prob  label nmaps                       geometry</span></span>
<span><span class="co">#&gt; 1  Absurdistan 0.00    0-1    70 POLYGON ((0.03238625 15.087...</span></span>
<span><span class="co">#&gt; 2  Absurdistan 0.25 0.25-1    70 POLYGON ((-0.5613637 14.420...</span></span>
<span><span class="co">#&gt; 3  Absurdistan 0.50  0.5-1    70 POLYGON ((-0.3717804 13.920...</span></span>
<span><span class="co">#&gt; 4  Absurdistan 0.75 0.75-1    70 POLYGON ((-0.2821971 13.287...</span></span>
<span><span class="co">#&gt; 5      Agrabah 0.00    0-1   129 POLYGON ((22.72428 31.9423,...</span></span>
<span><span class="co">#&gt; 6      Agrabah 0.25 0.25-1   129 MULTIPOLYGON (((23.22845 30...</span></span>
<span><span class="co">#&gt; 7      Agrabah 0.50  0.5-1   129 MULTIPOLYGON (((23.89511 29...</span></span>
<span><span class="co">#&gt; 8      Agrabah 0.75 0.75-1   129 MULTIPOLYGON (((23.69511 28...</span></span>
<span><span class="co">#&gt; 9    Arendelle 0.00    0-1    70 POLYGON ((8.23251 19.67039,...</span></span>
<span><span class="co">#&gt; 10   Arendelle 0.25 0.25-1    70 POLYGON ((9.028344 19.13706...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-contour-polygons-across-all-groups-and-by-period">Create contour polygons across all groups and by period<a class="anchor" aria-label="anchor" href="#create-contour-polygons-across-all-groups-and-by-period"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_contours.html">get_contours</a></span><span class="op">(</span><span class="va">df</span>, by_period <span class="op">=</span> <span class="cn">T</span>, grp_id <span class="op">=</span> <span class="va">name</span>, period_id <span class="op">=</span> <span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 440 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -10.55116 ymin: -23.1782 xmax: 46.47936 ymax: 35.56969</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;           name    period prob  label nmaps                       geometry</span></span>
<span><span class="co">#&gt; 1  Absurdistan 1800-1820 0.00    0-1    17 POLYGON ((0.4857152 15.0526...</span></span>
<span><span class="co">#&gt; 2  Absurdistan 1800-1820 0.25 0.25-1    17 MULTIPOLYGON (((-0.5142848 ...</span></span>
<span><span class="co">#&gt; 3  Absurdistan 1800-1820 0.50  0.5-1    17 MULTIPOLYGON (((-4.139285 1...</span></span>
<span><span class="co">#&gt; 4  Absurdistan 1800-1820 0.75 0.75-1    17 MULTIPOLYGON (((-0.01011809...</span></span>
<span><span class="co">#&gt; 5      Agrabah 1800-1820 0.00    0-1    37 POLYGON ((23.00267 31.9298,...</span></span>
<span><span class="co">#&gt; 6      Agrabah 1800-1820 0.25 0.25-1    37 MULTIPOLYGON (((23.24017 30...</span></span>
<span><span class="co">#&gt; 7      Agrabah 1800-1820 0.50  0.5-1    37 POLYGON ((24.42142 29.79646...</span></span>
<span><span class="co">#&gt; 8      Agrabah 1800-1820 0.75 0.75-1    37 MULTIPOLYGON (((25.1735 27....</span></span>
<span><span class="co">#&gt; 9    Arendelle 1800-1820 0.00    0-1    16 POLYGON ((6.828344 19.50865...</span></span>
<span><span class="co">#&gt; 10   Arendelle 1800-1820 0.25 0.25-1    16 MULTIPOLYGON (((7.403344 19...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="support-for-parallel-processing">Support for parallel processing:<a class="anchor" aria-label="anchor" href="#support-for-parallel-processing"></a>
</h2>
<p>Parallel processing is is implemented using the [future::future] framework. There are two ways of running jobs in parallel: <code>multicore</code> which uses ‘forking’ to run multiple jobs in parallel with shared memory and <code>multisession</code> which launches a set of background R sessions. ‘Forking’ can be faster than multisession because of the larger overhead associated with copying the active environment to each background R session (whereas forking processes shares memory). However, ‘forking’ is not supported on Windows platforms and is considered unstable when running from within RStudio (on both Windows and Unix systems such as MacOS). The function will automatically determine whether <code>multicore</code> is supported by the platform and choose the appropriate plan.</p>
<p>The greater overhead associated with <code>multisession</code> is primarily during the first parallel run in a given R session (since the background R sessions stays available for additional parallel jobs). It is possible to define a [future::plan(“multisession”)] in the global environment, which will minimize overhead in subsequent parallel jobs (apart from the first). The function will automatically detect if a <code>multisession</code> plan has been set globally and, thus, will not close background sessions after running.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ccappelen/legaciesR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ccappelen/legaciesR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing legaciesr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Christoffer Cappelen <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christoffer Cappelen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
