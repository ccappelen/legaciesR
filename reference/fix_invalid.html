<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fix Invalid Geometries — fix_invalid • legaciesr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fix Invalid Geometries — fix_invalid"><meta name="description" content="Rebuilds invalid geometries. If necessary, the functions will iteratively
lower the snapping precision if default options are inadequate."><meta property="og:description" content="Rebuilds invalid geometries. If necessary, the functions will iteratively
lower the snapping precision if default options are inadequate."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">legaciesr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ccappelen/legaciesR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fix Invalid Geometries</h1>
      <small class="dont-index">Source: <a href="https://github.com/ccappelen/legaciesR/blob/main/R/fix_invalid.R" class="external-link"><code>R/fix_invalid.R</code></a></small>
      <div class="d-none name"><code>fix_invalid.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Rebuilds invalid geometries. If necessary, the functions will iteratively
lower the snapping precision if default options are inadequate.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fix_invalid</span><span class="op">(</span></span>
<span>  <span class="va">shp</span>,</span>
<span>  max_precision <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">7</span>,</span>
<span>  min_precision <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  stop_if_invalid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">ncores</span>,</span>
<span>  report <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  reportColumns <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-shp">shp<a class="anchor" aria-label="anchor" href="#arg-shp"></a></dt>
<dd><p>An sf dataframe.</p></dd>


<dt id="arg-max-precision">max_precision<a class="anchor" aria-label="anchor" href="#arg-max-precision"></a></dt>
<dd><p>Integer, maximum level of precision for <code><a href="https://r-spatial.github.io/s2/reference/s2_options.html" class="external-link">s2::s2_options()</a></code>, default is 10^7.</p></dd>


<dt id="arg-min-precision">min_precision<a class="anchor" aria-label="anchor" href="#arg-min-precision"></a></dt>
<dd><p>Integer, minimum allowed precision for <code><a href="https://r-spatial.github.io/s2/reference/s2_options.html" class="external-link">s2::s2_options()</a></code>, default is 10. If geometry
is invalid after rebuilding with minimum precision allowed, the function will return an error if
<code>stop_if_invalid</code> is <code>TRUE</code> and a warning otherwise.</p></dd>


<dt id="arg-stop-if-invalid">stop_if_invalid<a class="anchor" aria-label="anchor" href="#arg-stop-if-invalid"></a></dt>
<dd><p>Logical, whether the function should return an error if it fails
to rebuild a valid geometry. The error message will indicate the row number of the invalid geometry.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Logical, whether a progress bar should be displayed. Default is <code>TRUE.</code></p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical, whether to use parallel processing with <code>ncores</code> number of cores.
See details below.</p></dd>


<dt id="arg-ncores">ncores<a class="anchor" aria-label="anchor" href="#arg-ncores"></a></dt>
<dd><p>Integer, number of cores to use for parallel processing. Default is all available cores minus 1.</p></dd>


<dt id="arg-report">report<a class="anchor" aria-label="anchor" href="#arg-report"></a></dt>
<dd><p>Logical, whether to report the number of valid, rebuilt, and invalid geometries. If
<code>reportColumns</code> is <code>FALSE</code>, no report will be generated.</p></dd>


<dt id="arg-reportcolumns">reportColumns<a class="anchor" aria-label="anchor" href="#arg-reportcolumns"></a></dt>
<dd><p>Logical, whether to return the status of each geometry in new columns
(<code>geom_valid</code>, <code>rebuilt</code>, and <code>snap_precision</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns an sf dataframe with the same number of features as the input. The dataframe includes
three new columns: <code>geom_valid</code> indicates whether the original geometry was valid (<code>TRUE</code>), <code>rebuilt</code>
indicates if the geometry was successfully rebuilt, and <code>snap_precision</code> indicates the snapping
precision used to rebuild geometry (if <code>rebuilt</code> is <code>FALSE</code>, <code>snap_precision</code> indicates the minimum snapping
precision that led to invalid geometry).</p>
    </div>
    <div class="section level2">
    <h2 id="support-for-parallel-processing">Support for parallel processing<a class="anchor" aria-label="anchor" href="#support-for-parallel-processing"></a></h2>


<p>Parallel processing is is implemented using the <a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future</a> framework. There are two ways
of running jobs in parallel: <code>multicore</code> which uses 'forking' to run multiple jobs in parallel with
shared memory and <code>multisession</code> which launches a set of background R sessions. 'Forking' can be faster
than multisession because of the larger overhead associated with copying the active environment to
each background R session (whereas forking processes shares memory). However, 'forking' is not
supported on Windows platforms and is considered unstable when running from within RStudio
(on both Windows and Unix systems such as MacOS). The function will automatically determine
whether <code>multicore</code> is supported by the platform and choose the appropriate plan.</p>
<p>The greater overhead associated with <code>multisession</code> is primarily during the first parallel
run in a given R session (since the background R sessions stays available for additional
parallel jobs). It is possible to define a <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> in the global environment,
which will minimize overhead in subsequent parallel jobs (apart from the first). The function will
automatically detect if a <code>multisession</code> plan has been set globally and, thus, will not close
background sessions after running.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christoffer Cappelen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

